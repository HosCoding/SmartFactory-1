using Oracle.ManagedDataAccess.Client;
using System.Drawing;

namespace WinFormsApp14
{
    public partial class Form1 : Form
    {
        static void Db()
        {
            string strConn = "Data Source=(DESCRIPTION=" +
                    "(ADDRESS_LIST=(ADDRESS=(PROTOCOL=TCP)" +
                    "(HOST=localhost)(PORT=9000)))" +
                    "(CONNECT_DATA=(SERVER=DEDICATED)" +
                    "(SERVICE_NAME=xe)));" +
                    "User Id=SCOTT2;Password=TIGER;";

            //1.연결 객체 만들기 - Client
            OracleConnection conn = new OracleConnection(strConn);
            //2.데이터베이스 접속을 위한 연결
            conn.Open();
            //3.서버와 함께 신나게 놀기
            //3.1 Query 명령객체 만들기
            CreateTable(conn);

        }
        static void CreateTable(OracleConnection conn)
        {
            OracleCommand cmd = new OracleCommand();
            cmd.Connection = conn; //연결객체와 연동
            cmd.CommandText = "Drop Table Customer";
            cmd.ExecuteNonQuery();

            cmd.CommandText = "CREATE TABLE Customer( " +
                             "LOGIN_ID       VARCHAR2(20) NOT NULL PRIMARY KEY, " +
                             "LOGIN_PWD    VARCHAR2(20) NOT NULL, " +
                             "CNAME    VARCHAR2(20) NOT NULL, " +
                             "HP      VARCHAR2(20), " +
                             "ADDRESS      VARCHAR2(50))";
            cmd.ExecuteNonQuery();
            conn.Close();
        }
        public Form1()
        {
            InitializeComponent();
        }



        private void button1_Click_1(object sender, EventArgs e)
        {
            string id = txtID.Text;
            string pwd = txtPWD.Text;
            OracleCommand cmd = new OracleCommand();

            cmd.Parameters.Add(new OracleParameter("LOGIN_ID", id));
            cmd.Parameters.Add(new OracleParameter("LOGIN_PWD", pwd));
            OracleDataReader dr = cmd.ExecuteReader();
            
            if (dr.Read())
            {
                MessageBox.Show("로그인 완료");
            }
            else
            {
                MessageBox.Show("아이디 혹은 비밀번호를 다시 확인해주세요.");
            }
            dr.Close();
        }

        private void button2_Click(object sender, EventArgs e)
        {
            Form2 frm2 = new Form2(this, "안녕하세요");
            frm2.ShowDialog();
        }

        private void Form1_Load(object sender, EventArgs e)
        {
            Db();
        }
    }
}
